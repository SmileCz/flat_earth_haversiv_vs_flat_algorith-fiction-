<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ PlochÃ¡ ZemÄ› - KalkulaÄka vzdÃ¡lenostÃ­ | Flat Earth Distance Calculator</title>
    <script>
    // PÅ™evod DMS (stupnÄ›, minuty, sekundy) na desetinnÃ© ÄÃ­slo
    function parseCoordinate(input) {
        if (typeof input === 'number') return input;
        if (typeof input !== 'string') return NaN;
        input = input.trim().replace(/,/g, '.');
        // Pokud je to uÅ¾ ÄÃ­slo
        if (/^-?\d+(\.\d+)?$/.test(input)) return parseFloat(input);
        // DMS formÃ¡t: 50Â°05'12.34" nebo 50 05 12.34 nebo 50Â° 5' 12.34''
        const regex = /^(-?\d+)[Â°\s]+(\d+)[\'â€²\s]+(\d+(?:\.\d+)?)["â€â€³\s]*([NSEW])?$/i;
        const match = input.match(regex);
        if (match) {
            let deg = parseFloat(match[1]);
            let min = parseFloat(match[2]);
            let sec = parseFloat(match[3]);
            let dir = match[4] ? match[4].toUpperCase() : null;
            let val = Math.abs(deg) + min/60 + sec/3600;
            if (deg < 0) val *= -1;
            if (dir === 'S' || dir === 'W') val *= -1;
            return val;
        }
        // Zkusit rozdÄ›lit podle mezer
        const parts = input.split(/\s+/);
        if (parts.length === 3) {
            let deg = parseFloat(parts[0]);
            let min = parseFloat(parts[1]);
            let sec = parseFloat(parts[2]);
            let val = Math.abs(deg) + min/60 + sec/3600;
            if (deg < 0) val *= -1;
            return val;
        }
        return NaN;
    }
    </script>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', 'Comic Sans MS', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .lang-switch {
            text-align: right;
            margin-bottom: 10px;
        }
        .lang-switch button {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 20px;
            margin: 0 5px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }
        .lang-switch button:hover, .lang-switch button.active {
            background: white;
            color: #1a1a2e;
        }
        h1 {
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-size: 2.2em;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #a0d2eb;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .card h2 {
            color: #0f3460;
            border-bottom: 3px solid #0f3460;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .emoji {
            font-size: 1.5em;
        }
        .intro-box {
            background: linear-gradient(135deg, #e8f4fd 0%, #d4e8f7 100%);
            border-left: 5px solid #3498db;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.1em;
            line-height: 1.8;
        }
        .intro-box p {
            margin: 10px 0;
        }
        .warning-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);
            border-left: 5px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.05em;
            line-height: 1.8;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .input-group input:focus {
            outline: none;
            border-color: #3498db;
        }
        .input-group small {
            color: #888;
            font-size: 0.85em;
        }
        .point-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ed 100%);
            padding: 20px;
            border-radius: 15px;
        }
        .point-card.point-a {
            border-top: 5px solid #e74c3c;
        }
        .point-card.point-b {
            border-top: 5px solid #3498db;
        }
        .point-card h3 {
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
        }
        .dot-a { background: #e74c3c; }
        .dot-b { background: #3498db; }
        button.calc-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: block;
            margin: 20px auto;
            font-weight: bold;
        }
        button.calc-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(17, 153, 142, 0.5);
        }
        .map-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }
        @media (max-width: 900px) {
            .map-container {
                grid-template-columns: 1fr;
            }
        }
        .flat-earth-image {
            text-align: center;
        }
        .flat-earth-image img, .flat-earth-image svg {
            max-width: 100%;
            border-radius: 15px;
        }
        #canvas-container {
            text-align: center;
        }
        canvas {
            background: #1a1a2e;
            border-radius: 15px;
            max-width: 100%;
        }
        .calculation-step {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #0f3460;
        }
        .calculation-step h4 {
            margin-top: 0;
            color: #0f3460;
        }
        .formula {
            background: #2d3436;
            color: #00ff88;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
            font-size: 0.95em;
        }
        .substitution {
            background: #fff3cd;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Consolas', 'Courier New', monospace;
            overflow-x: auto;
        }
        .result-value {
            background: #d4edda;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1em;
        }
        .final-result {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5em;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .comparison-box {
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        .comparison-box.flat {
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
            color: white;
        }
        .comparison-box.globe {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        .comparison-box h3 {
            margin-top: 0;
        }
        .comparison-box .distance {
            font-size: 2em;
            font-weight: bold;
        }
        .match {
            background: #28a745;
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
            font-size: 1.2em;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            background: rgba(0,0,0,0.4);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
        }
        .explanation {
            background: #e8f4fd;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        .explanation h4 {
            color: #0066cc;
            margin-top: 0;
        }
        .explanation p {
            line-height: 1.8;
        }
        .coordinate-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        .coordinate-info h4 {
            margin-top: 0;
        }
        .coordinate-info ul {
            margin: 0;
            padding-left: 20px;
        }
        .coordinate-info li {
            margin: 8px 0;
        }
        @media (max-width: 600px) {
            .comparison {
                grid-template-columns: 1fr;
            }
            h1 {
                font-size: 1.6em;
            }
        }
        .hidden { display: none !important; }
        
        /* Logo styling */
        .header-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .logo {
            max-width: 80px;
            height: auto;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
            transition: transform 0.3s;
            background: transparent;
            border: none;
            border-radius: 10px;
        }
        .logo:hover {
            transform: scale(1.1);
        }
        
        /* Footer styling */
        footer {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            text-align: center;
            padding: 30px 20px;
            margin-top: 40px;
            border-top: 3px solid #0f3460;
        }
        footer .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        footer .footer-logo {
            max-width: 100px;
            margin-bottom: 15px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
            background: transparent;
            border-radius: 10px;
        }
        footer h3 {
            color: #38ef7d;
            margin: 10px 0;
            font-size: 1.2em;
        }
        footer p {
            margin: 8px 0;
            color: #a0d2eb;
        }
        footer .organization {
            font-size: 1.3em;
            font-weight: bold;
            color: #38ef7d;
            margin: 15px 0;
        }
        footer .license {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 0.9em;
        }
        footer a {
            color: #38ef7d;
            text-decoration: none;
            transition: color 0.3s;
        }
        footer a:hover {
            color: #11998e;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Language Switch -->
        <div class="lang-switch">
            <button id="btn-cs" class="active" onclick="setLanguage('cs')">CZ ÄŒeÅ¡tina</button>
            <button id="btn-en" onclick="setLanguage('en')">USA English</button>
        </div>

        <div class="header-container">
            <img src="img/Logo_Space_League_of_Justice_2025.png" alt="Space League of Justice Logo" class="logo">
            <h1 style="margin: 0;">
                <span class="lang-cs">ğŸŒ KalkulaÄka vzdÃ¡lenostÃ­ na PlochÃ© Zemi ğŸ—ºï¸</span>
                <span class="lang-en hidden">ğŸŒ Flat Earth Distance Calculator ğŸ—ºï¸</span>
            </h1>
            <img src="img/Logo_Space_League_of_Justice_2025.png" alt="Space League of Justice Logo" class="logo">
        </div>
        <p class="subtitle">
            <span class="lang-cs">AzimutÃ¡lnÃ­ ekvidistantnÃ­ projekce - mapa kterou pouÅ¾Ã­vajÃ­ plochozemci</span>
            <span class="lang-en hidden">Azimuthal Equidistant Projection - the map flat earthers use</span>
        </p>

        <!-- Ãšvod -->
        <div class="card">
            <h2>
                <span class="emoji">ğŸ“š</span>
                <span class="lang-cs">Co to vlastnÄ› poÄÃ­tÃ¡me?</span>
                <span class="lang-en hidden">What are we calculating?</span>
            </h2>
            <div class="intro-box">
                <p class="lang-cs">
                    ğŸ¯ <strong>PÅ™edstav si</strong>, Å¾e ZemÄ› je placatÃ¡ jako pizza. SevernÃ­ pÃ³l je pÅ™esnÄ› uprostÅ™ed!
                </p>
                <p class="lang-en hidden">
                    ğŸ¯ <strong>Imagine</strong> the Earth is flat like a pizza. The North Pole is right in the middle!
                </p>
                <p class="lang-cs">
                    ğŸ”µ <strong>RovnobÄ›Å¾ky</strong> jsou krouÅ¾ky kolem stÅ™edu. RovnÃ­k (0Â°) je kruh uprostÅ™ed cesty. SevernÃ­ pÃ³l (+90Â°) je stÅ™ed. JiÅ¾nÃ­ oblasti (-90Â°) tvoÅ™Ã­ vnÄ›jÅ¡Ã­ okraj.
                </p>
                <p class="lang-en hidden">
                    ğŸ”µ <strong>Parallels</strong> are circles around the center. The Equator (0Â°) is a circle halfway. North Pole (+90Â°) is the center. Southern areas (-90Â°) form the outer edge.
                </p>
                <p class="lang-cs">
                    ğŸ“ <strong>ZemÄ›pisnÃ¡ Å¡Ã­Å™ka:</strong> 0Â° = rovnÃ­k, +90Â° = severnÃ­ pÃ³l (stÅ™ed), -90Â° = jiÅ¾nÃ­ pÃ³l (ledovÃ¡ stÄ›na na okraji!)
                </p>
                <p class="lang-en hidden">
                    ğŸ“ <strong>Latitude:</strong> 0Â° = equator, +90Â° = North Pole (center), -90Â° = South Pole (ice wall at the edge!)
                </p>
                <p class="lang-cs">
                    ğŸ§­ <strong>PolednÃ­ky</strong> jsou jako Å™ezy pizzy - vedou ze stÅ™edu (severnÃ­ho pÃ³lu) ven k ledovÃ© stÄ›nÄ›.
                </p>
                <p class="lang-en hidden">
                    ğŸ§­ <strong>Meridians</strong> are like pizza slices - they go from the center (North Pole) outward to the ice wall.
                </p>
            </div>

            <div class="coordinate-info">
                <h4>
                    <span class="lang-cs">ğŸ“ SouÅ™adnicovÃ½ systÃ©m (stejnÃ½ jako GPS!)</span>
                    <span class="lang-en hidden">ğŸ“ Coordinate System (same as GPS!)</span>
                </h4>
                <ul>
                    <li class="lang-cs"><strong>ZemÄ›pisnÃ¡ Å¡Ã­Å™ka (latitude):</strong> 0Â° na rovnÃ­ku, +90Â° severnÃ­ pÃ³l (stÅ™ed mapy), -90Â° jiÅ¾nÃ­ oblasti (okraj mapy)</li>
                    <li class="lang-en hidden"><strong>Latitude:</strong> 0Â° at equator, +90Â° North Pole (center of map), -90Â° southern areas (edge of map)</li>
                    <li class="lang-cs"><strong>ZemÄ›pisnÃ¡ dÃ©lka (longitude):</strong> 0Â° Greenwich, kladnÃ© na vÃ½chod, zÃ¡pornÃ© na zÃ¡pad</li>
                    <li class="lang-en hidden"><strong>Longitude:</strong> 0Â° Greenwich, positive eastward, negative westward</li>
                    <li class="lang-cs"><strong>Na plochÃ© mapÄ›:</strong> SevernÃ­ pÃ³l (+90Â°) je uprostÅ™ed, rovnÃ­k (0Â°) je kruh v polovinÄ›, "Antarktida" (-90Â°) tvoÅ™Ã­ ledovou stÄ›nu kolem dokola</li>
                    <li class="lang-en hidden"><strong>On flat map:</strong> North Pole (+90Â°) is in center, equator (0Â°) is circle halfway, "Antarctica" (-90Â°) forms ice wall all around</li>
                </ul>
            </div>

            <div class="warning-box">
                <p class="lang-cs">
                    âš ï¸ <strong>KLÃÄŒOVÃ POZNATEK:</strong> Aby vzdÃ¡lenosti mezi JAKÃMIKOLIV dvÄ›ma mÃ­sty sedÄ›ly (Praha-New York, Sydney-KapskÃ© mÄ›sto, i dva body na rovnÃ­ku!), 
                    musÃ­me pouÅ¾Ã­t <strong>sfÃ©rickÃ½ kosinovÃ½ vzorec</strong>. Je to STEJNÃ vzorec jako pro kulatou Zemi!
                </p>
                <p class="lang-en hidden">
                    âš ï¸ <strong>KEY INSIGHT:</strong> For distances between ANY two places to be correct (Prague-New York, Sydney-Cape Town, even two points on the equator!), 
                    we must use the <strong>spherical law of cosines</strong>. It's the SAME formula as for the globe Earth!
                </p>
            </div>
        </div>

        <!-- VstupnÃ­ formulÃ¡Å™ -->
        <div class="card">
            <h2>
                <span class="emoji">ğŸ“</span>
                <span class="lang-cs">Zadej Ãºdaje</span>
                <span class="lang-en hidden">Enter data</span>
            </h2>
            
            <div class="input-group" style="max-width: 400px;">
                <label for="circumference">
                    <span class="lang-cs">ğŸŒ Obvod rovnÃ­ku (km):</span>
                    <span class="lang-en hidden">ğŸŒ Equator circumference (km):</span>
                </label>
                <input type="number" id="circumference" value="40075" step="0.01">
                <small>
                    <span class="lang-cs">StandardnÃ­ hodnota: 40 075 km. Na plochÃ© mapÄ› je to obvod kruhu v polovinÄ› cesty od stÅ™edu k okraji.</span>
                    <span class="lang-en hidden">Standard value: 40,075 km. On the flat map, this is the circumference of the circle halfway from center to edge.</span>
                </small>
            </div>

            <div class="grid">
                <div class="point-card point-a">
                    <h3>
                        <span class="dot dot-a"></span>
                        <span class="lang-cs">Bod A (PrvnÃ­ mÃ­sto)</span>
                        <span class="lang-en hidden">Point A (First location)</span>
                    </h3>
                    <div class="input-group">
                        <label>
                            <span class="lang-cs">ğŸ™ï¸ Vybrat mÄ›sto:</span>
                            <span class="lang-en hidden">ğŸ™ï¸ Select city:</span>
                        </label>
                        <select id="city1" onchange="selectCity(1)" style="width:100%; padding:10px; border-radius:8px; border:2px solid #ddd; font-size:14px;">
                            <option value="">-- VlastnÃ­ souÅ™adnice --</option>
                            <optgroup label="Evropa / Europe">
                                <option value="50.0755,14.4378" selected>ğŸ‡¨ğŸ‡¿ Praha (Prague)</option>
                                <option value="48.1486,17.1077">ğŸ‡¸ğŸ‡° Bratislava</option>
                                <option value="48.8566,2.3522">ğŸ‡«ğŸ‡· PaÅ™Ã­Å¾ (Paris)</option>
                                <option value="52.5200,13.4050">ğŸ‡©ğŸ‡ª BerlÃ­n (Berlin)</option>
                                <option value="41.9028,12.4964">ğŸ‡®ğŸ‡¹ Å˜Ã­m (Rome)</option>
                                <option value="40.4168,-3.7038">ğŸ‡ªğŸ‡¸ Madrid</option>
                                <option value="55.7558,37.6173">ğŸ‡·ğŸ‡º Moskva (Moscow)</option>
                                <option value="64.1466,-21.9426">ğŸ‡®ğŸ‡¸ ReykjavÃ­k</option>
                                <option value="42.6507,18.0944">ğŸ‡²ğŸ‡ª DubrovnÃ­k (Dubrovnik)</option>
                            </optgroup>
                            <optgroup label="USA">
                                <option value="40.7128,-74.0060">ğŸ‡ºğŸ‡¸ New York</option>
                                <option value="38.9072,-77.0369">ğŸ‡ºğŸ‡¸ Washington D.C.</option>
                                <option value="34.0522,-118.2437">ğŸ‡ºğŸ‡¸ Los Angeles</option>
                                <option value="37.7749,-122.4194">ğŸ‡ºğŸ‡¸ San Francisco</option>
                                <option value="41.8781,-87.6298">ğŸ‡ºğŸ‡¸ Chicago</option>
                                <option value="25.7617,-80.1918">ğŸ‡ºğŸ‡¸ Miami</option>
                                <option value="29.7604,-95.3698">ğŸ‡ºğŸ‡¸ Houston</option>
                                <option value="47.6062,-122.3321">ğŸ‡ºğŸ‡¸ Seattle</option>
                                <option value="42.3601,-71.0589">ğŸ‡ºğŸ‡¸ Boston</option>
                                <option value="39.7392,-104.9903">ğŸ‡ºğŸ‡¸ Denver</option>
                                <option value="36.1699,-115.1398">ğŸ‡ºğŸ‡¸ Las Vegas</option>
                                <option value="21.3099,-157.8581">ğŸ‡ºğŸ‡¸ Honolulu (Hawaii)</option>
                            </optgroup>
                            <optgroup label="OstatnÃ­ / Other">
                                <option value="19.4326,-99.1332">ğŸ‡²ğŸ‡½ Mexico City</option>
                                <option value="21.1619,-86.8515">ğŸ‡²ğŸ‡½ CancÃºn</option>
                                <option value="-22.9068,-43.1729">ğŸ‡§ğŸ‡· Rio de Janeiro</option>
                                <option value="-34.6037,-58.3816">ğŸ‡¦ğŸ‡· Buenos Aires</option>
                                <option value="-33.8688,151.2093">ğŸ‡¦ğŸ‡º Sydney</option>
                                <option value="-37.8136,144.9631">ğŸ‡¦ğŸ‡º Melbourne</option>
                                <option value="35.6762,139.6503">ğŸ‡¯ğŸ‡µ Tokio (Tokyo)</option>
                                <option value="37.5665,126.9780">ğŸ‡°ğŸ‡· Soul (Seoul)</option>
                                <option value="39.9042,116.4074">ğŸ‡¨ğŸ‡³ Peking (Beijing)</option>
                                <option value="31.2304,121.4737">ğŸ‡¨ğŸ‡³ Å anghaj (Shanghai)</option>
                                <option value="22.3193,114.1694">ğŸ‡­ğŸ‡° Hong Kong</option>
                                <option value="1.3521,103.8198">ğŸ‡¸ğŸ‡¬ Singapur (Singapore)</option>
                                <option value="28.6139,77.2090">ğŸ‡®ğŸ‡³ DillÃ­ (Delhi)</option>
                                <option value="19.0760,72.8777">ğŸ‡®ğŸ‡³ Bombaj (Mumbai)</option>
                                <option value="-1.2921,36.8219">ğŸ‡°ğŸ‡ª Nairobi</option>
                                <option value="-33.9249,18.4241">ğŸ‡¿ğŸ‡¦ KapskÃ© mÄ›sto (Cape Town)</option>
                                <option value="30.0444,31.2357">ğŸ‡ªğŸ‡¬ KÃ¡hira (Cairo)</option>
                                <option value="25.2048,55.2708">ğŸ‡¦ğŸ‡ª Dubaj (Dubai)</option>
                                <option value="-41.2865,174.7762">ğŸ‡³ğŸ‡¿ Wellington</option>
                            </optgroup>
                            <optgroup label="Letoviska / Resorts">
                                <option value="-8.3405,115.0920">ğŸ‡®ğŸ‡© Bali (Denpasar)</option>
                                <option value="4.1755,73.5093">ğŸ‡²ğŸ‡» Maledivy (MalÃ©)</option>
                                <option value="18.4655,-69.9312">ğŸ‡©ğŸ‡´ Punta Cana</option>
                                <option value="13.0827,80.2707">ğŸ‡®ğŸ‡³ Chennai (Marina Beach)</option>
                            </optgroup>
                            <optgroup label="PlochozemskÃ© cÃ­le / Flat Earth Landmarks">
                                <option value="27.9881,86.9250">ğŸ”ï¸ Mount Everest</option>
                                <option value="-77.8419,166.6863">â„ï¸ McMurdo (Antarktida)</option>
                                <option value="-75.583,-26.567">â„ï¸ Halley (Antarktida)</option>
                                <option value="-66.283,110.533">â„ï¸ Casey (Antarktida)</option>
                                <option value="-74.65,164.12">â„ï¸ Scott Base (Antarktida)</option>
                                <option value="-70.65,-8.25">â„ï¸ Neumayer (Antarktida)</option>
                                <option value="38.8409,-105.0423">ğŸ”­ Pikes Peak Observatory</option>
                                <option value="38.9997,-104.49723">ğŸ“¡ Heffron (USAF)</option>
                                <option value="90,0">ğŸ§­ SevernÃ­ pÃ³l (North Pole)</option>
                                <option value="-90,0">ğŸ§­ JiÅ¾nÃ­ pÃ³l (South Pole)</option>
                                <option value="0,0">ğŸ§­ NultÃ½ bod (0Â°, 0Â°)</option>
                                <option value="23.5,0">â˜€ï¸ ObratnÃ­k Raka (Tropic Cancer)</option>
                                <option value="-23.5,0">â˜€ï¸ ObratnÃ­k Koz. (Tropic Capric.)</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="lat1">
                            <span class="lang-cs">ZemÄ›pisnÃ¡ Å¡Ã­Å™ka (Â°):</span>
                            <span class="lang-en hidden">Latitude (Â°):</span>
                        </label>
                        <input type="number" id="lat1" value="50.0755" step="0.0001" min="-90" max="90" onchange="document.getElementById('city1').value=''">
                    </div>
                    <div class="input-group">
                        <label for="lon1">
                            <span class="lang-cs">ZemÄ›pisnÃ¡ dÃ©lka (Â°):</span>
                            <span class="lang-en hidden">Longitude (Â°):</span>
                        </label>
                        <input type="number" id="lon1" value="14.4378" step="0.0001" min="-180" max="180" onchange="document.getElementById('city1').value=''">
                    </div>
                </div>

                <div class="point-card point-b">
                    <h3>
                        <span class="dot dot-b"></span>
                        <span class="lang-cs">Bod B (DruhÃ© mÃ­sto)</span>
                        <span class="lang-en hidden">Point B (Second location)</span>
                    </h3>
                    <div class="input-group">
                        <label>
                            <span class="lang-cs">ğŸ™ï¸ Vybrat mÄ›sto:</span>
                            <span class="lang-en hidden">ğŸ™ï¸ Select city:</span>
                        </label>
                        <select id="city2" onchange="selectCity(2)" style="width:100%; padding:10px; border-radius:8px; border:2px solid #ddd; font-size:14px;">
                            <option value="">-- VlastnÃ­ souÅ™adnice --</option>
                            <optgroup label="Evropa / Europe">
                                <option value="50.0755,14.4378">ğŸ‡¨ğŸ‡¿ Praha (Prague)</option>
                                <option value="48.1486,17.1077">ğŸ‡¸ğŸ‡° Bratislava</option>
                                <option value="48.8566,2.3522">ğŸ‡«ğŸ‡· PaÅ™Ã­Å¾ (Paris)</option>
                                <option value="52.5200,13.4050">ğŸ‡©ğŸ‡ª BerlÃ­n (Berlin)</option>
                                <option value="41.9028,12.4964">ğŸ‡®ğŸ‡¹ Å˜Ã­m (Rome)</option>
                                <option value="40.4168,-3.7038">ğŸ‡ªğŸ‡¸ Madrid</option>
                                <option value="55.7558,37.6173">ğŸ‡·ğŸ‡º Moskva (Moscow)</option>
                                <option value="64.1466,-21.9426">ğŸ‡®ğŸ‡¸ ReykjavÃ­k</option>
                                <option value="42.6507,18.0944">ğŸ‡²ğŸ‡ª DubrovnÃ­k (Dubrovnik)</option>
                            </optgroup>
                            <optgroup label="USA">
                                <option value="40.7128,-74.0060" selected>ğŸ‡ºğŸ‡¸ New York</option>
                                <option value="38.9072,-77.0369">ğŸ‡ºğŸ‡¸ Washington D.C.</option>
                                <option value="34.0522,-118.2437">ğŸ‡ºğŸ‡¸ Los Angeles</option>
                                <option value="37.7749,-122.4194">ğŸ‡ºğŸ‡¸ San Francisco</option>
                                <option value="41.8781,-87.6298">ğŸ‡ºğŸ‡¸ Chicago</option>
                                <option value="25.7617,-80.1918">ğŸ‡ºğŸ‡¸ Miami</option>
                                <option value="29.7604,-95.3698">ğŸ‡ºğŸ‡¸ Houston</option>
                                <option value="47.6062,-122.3321">ğŸ‡ºğŸ‡¸ Seattle</option>
                                <option value="42.3601,-71.0589">ğŸ‡ºğŸ‡¸ Boston</option>
                                <option value="39.7392,-104.9903">ğŸ‡ºğŸ‡¸ Denver</option>
                                <option value="36.1699,-115.1398">ğŸ‡ºğŸ‡¸ Las Vegas</option>
                                <option value="21.3099,-157.8581">ğŸ‡ºğŸ‡¸ Honolulu (Hawaii)</option>
                            </optgroup>
                            <optgroup label="OstatnÃ­ / Other">
                                <option value="19.4326,-99.1332">ğŸ‡²ğŸ‡½ Mexico City</option>
                                <option value="21.1619,-86.8515">ğŸ‡²ğŸ‡½ CancÃºn</option>
                                <option value="-22.9068,-43.1729">ğŸ‡§ğŸ‡· Rio de Janeiro</option>
                                <option value="-34.6037,-58.3816">ğŸ‡¦ğŸ‡· Buenos Aires</option>
                                <option value="-33.8688,151.2093">ğŸ‡¦ğŸ‡º Sydney</option>
                                <option value="-37.8136,144.9631">ğŸ‡¦ğŸ‡º Melbourne</option>
                                <option value="35.6762,139.6503">ğŸ‡¯ğŸ‡µ Tokio (Tokyo)</option>
                                <option value="37.5665,126.9780">ğŸ‡°ğŸ‡· Soul (Seoul)</option>
                                <option value="39.9042,116.4074">ğŸ‡¨ğŸ‡³ Peking (Beijing)</option>
                                <option value="31.2304,121.4737">ğŸ‡¨ğŸ‡³ Å anghaj (Shanghai)</option>
                                <option value="22.3193,114.1694">ğŸ‡­ğŸ‡° Hong Kong</option>
                                <option value="1.3521,103.8198">ğŸ‡¸ğŸ‡¬ Singapur (Singapore)</option>
                                <option value="28.6139,77.2090">ğŸ‡®ğŸ‡³ DillÃ­ (Delhi)</option>
                                <option value="19.0760,72.8777">ğŸ‡®ğŸ‡³ Bombaj (Mumbai)</option>
                                <option value="-1.2921,36.8219">ğŸ‡°ğŸ‡ª Nairobi</option>
                                <option value="-33.9249,18.4241">ğŸ‡¿ğŸ‡¦ KapskÃ© mÄ›sto (Cape Town)</option>
                                <option value="30.0444,31.2357">ğŸ‡ªğŸ‡¬ KÃ¡hira (Cairo)</option>
                                <option value="25.2048,55.2708">ğŸ‡¦ğŸ‡ª Dubaj (Dubai)</option>
                                <option value="-41.2865,174.7762">ğŸ‡³ğŸ‡¿ Wellington</option>
                            </optgroup>
                            <optgroup label="Letoviska / Resorts">
                                <option value="-8.3405,115.0920">ğŸ‡®ğŸ‡© Bali (Denpasar)</option>
                                <option value="4.1755,73.5093">ğŸ‡²ğŸ‡» Maledivy (MalÃ©)</option>
                                <option value="18.4655,-69.9312">ğŸ‡©ğŸ‡´ Punta Cana</option>
                                <option value="13.0827,80.2707">ğŸ‡®ğŸ‡³ Chennai (Marina Beach)</option>
                            </optgroup>
                            <optgroup label="PlochozemskÃ© cÃ­le / Flat Earth Landmarks">
                                <option value="27.9881,86.9250">ğŸ”ï¸ Mount Everest</option>
                                <option value="-77.8419,166.6863">â„ï¸ McMurdo (Antarktida)</option>
                                <option value="-75.583,-26.567">â„ï¸ Halley (Antarktida)</option>
                                <option value="-66.283,110.533">â„ï¸ Casey (Antarktida)</option>
                                <option value="-74.65,164.12">â„ï¸ Scott Base (Antarktida)</option>
                                <option value="-70.65,-8.25">â„ï¸ Neumayer (Antarktida)</option>
                                <option value="38.8409,-105.0423">ğŸ”­ Pikes Peak Observatory</option>
                                <option value="38.9997,-104.49723">ğŸ“¡ Heffron (USAF)</option>
                                <option value="90,0">ğŸ§­ SevernÃ­ pÃ³l (North Pole)</option>
                                <option value="-90,0">ğŸ§­ JiÅ¾nÃ­ pÃ³l (South Pole)</option>
                                <option value="0,0">ğŸ§­ NultÃ½ bod (0Â°, 0Â°)</option>
                                <option value="23.5,0">â˜€ï¸ ObratnÃ­k Raka (Tropic Cancer)</option>
                                <option value="-23.5,0">â˜€ï¸ ObratnÃ­k Koz. (Tropic Capric.)</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="lat2">
                            <span class="lang-cs">ZemÄ›pisnÃ¡ Å¡Ã­Å™ka (Â°):</span>
                            <span class="lang-en hidden">Latitude (Â°):</span>
                        </label>
                        <input type="number" id="lat2" value="40.7128" step="0.0001" min="-90" max="90" onchange="document.getElementById('city2').value=''">
                    </div>
                    <div class="input-group">
                        <label for="lon2">
                            <span class="lang-cs">ZemÄ›pisnÃ¡ dÃ©lka (Â°):</span>
                            <span class="lang-en hidden">Longitude (Â°):</span>
                        </label>
                        <input type="number" id="lon2" value="-74.0060" step="0.0001" min="-180" max="180" onchange="document.getElementById('city2').value=''">
                    </div>
                </div>
            </div>

            <button class="calc-btn" onclick="calculate()">
                <span class="lang-cs">ğŸ§® SpoÄÃ­tej vzdÃ¡lenost!</span>
                <span class="lang-en hidden">ğŸ§® Calculate distance!</span>
            </button>
        </div>

        <!-- Vizualizace -->
        <div class="card">
            <h2>
                <span class="emoji">ğŸ—ºï¸</span>
                <span class="lang-cs">Mapa plochÃ© ZemÄ› (AzimutÃ¡lnÃ­ ekvidistantnÃ­ projekce)</span>
                <span class="lang-en hidden">Flat Earth Map (Azimuthal Equidistant Projection)</span>
            </h2>
            <div class="explanation">
                <h4>
                    <span class="lang-cs">ğŸ• Jak ÄÃ­st tuto mapu?</span>
                    <span class="lang-en hidden">ğŸ• How to read this map?</span>
                </h4>
                <p class="lang-cs">
                    Toto je <strong>AzimutÃ¡lnÃ­ ekvidistantnÃ­ projekce</strong> - pÅ™esnÄ› ta mapa, kterou plochozemci pouÅ¾Ã­vajÃ­! 
                    <br>â€¢ <strong>StÅ™ed (90Â°N)</strong> = SevernÃ­ pÃ³l
                    <br>â€¢ <strong>Kruh uprostÅ™ed (0Â°)</strong> = RovnÃ­k  
                    <br>â€¢ <strong>VnÄ›jÅ¡Ã­ okraj (-90Â°)</strong> = "Antarktida" / LedovÃ¡ stÄ›na
                    <br>ÄŒÃ­m niÅ¾Å¡Ã­ zemÄ›pisnÃ¡ Å¡Ã­Å™ka, tÃ­m dÃ¡l od stÅ™edu!
                </p>
                <p class="lang-en hidden">
                    This is the <strong>Azimuthal Equidistant Projection</strong> - exactly the map flat earthers use! 
                    <br>â€¢ <strong>Center (90Â°N)</strong> = North Pole
                    <br>â€¢ <strong>Circle in middle (0Â°)</strong> = Equator  
                    <br>â€¢ <strong>Outer edge (-90Â°)</strong> = "Antarctica" / Ice Wall
                    <br>The lower the latitude, the farther from center!
                </p>
            </div>
            
            <div class="map-container" style="grid-template-columns: 1fr;">
                <!-- InteraktivnÃ­ mapa s reÃ¡lnÃ½m obrÃ¡zkem -->
                <div id="canvas-container" style="position: relative; max-width: 600px; margin: 0 auto;">
                    <canvas id="flatEarthCanvas" width="600" height="600"></canvas>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background: #e74c3c;"></div> 
                            <span class="lang-cs">Bod A</span>
                            <span class="lang-en hidden">Point A</span>
                        </div>
                        <div class="legend-item"><div class="legend-color" style="background: #3498db;"></div> 
                            <span class="lang-cs">Bod B</span>
                            <span class="lang-en hidden">Point B</span>
                        </div>
                        <div class="legend-item"><div class="legend-color" style="background: #2ecc71;"></div> 
                            <span class="lang-cs">VzdÃ¡lenost</span>
                            <span class="lang-en hidden">Distance</span>
                        </div>
                    </div>
                </div>

                <!-- DetailnÃ­ pohled -->
                <div id="detail-container" style="max-width: 600px; margin: 20px auto 0;">
                    <h4 style="text-align: center; color: #0f3460; margin-bottom: 10px;">
                        <span class="lang-cs">ğŸ” DetailnÃ­ pohled (pÅ™iblÃ­Å¾enÃ­)</span>
                        <span class="lang-en hidden">ğŸ” Detail view (zoom)</span>
                    </h4>
                    <canvas id="detailCanvas" width="600" height="600" style="border-radius: 15px; background: #f0f0f0;"></canvas>
                    <p style="text-align: center; color: #888; font-size: 0.85em; margin-top: 8px;">
                        <span class="lang-cs">AutomatickÃ© pÅ™iblÃ­Å¾enÃ­ na oblast mezi body A a B</span>
                        <span class="lang-en hidden">Auto-zoom to area between points A and B</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- VÃ½poÄet krok za krokem -->
        <div class="card" id="calculation-card" style="display: none;">
            <h2>
                <span class="emoji">ğŸ”¢</span>
                <span class="lang-cs">VÃ½poÄet krok za krokem</span>
                <span class="lang-en hidden">Step-by-step calculation</span>
            </h2>
            <div id="calculation-steps"></div>
        </div>

        <!-- VÃ½sledek -->
        <div class="card" id="result-card" style="display: none;">
            <h2>
                <span class="emoji">ğŸ‰</span>
                <span class="lang-cs">VÃ½sledek</span>
                <span class="lang-en hidden">Result</span>
            </h2>
            <div id="result-content"></div>
        </div>
    </div>

    <!-- Footer / ZÃ¡patÃ­ -->
    <footer>
        <div class="footer-content">
            <img src="img/Logo_Space_League_of_Justice_2025.png" alt="Space League of Justice Logo" class="footer-logo">
            
            <div class="organization">
                <span class="lang-cs">ğŸš€ Space League of Justice</span>
                <span class="lang-en hidden">ğŸš€ Space League of Justice</span>
            </div>
            
            <h3>
                <span class="lang-cs">ğŸ‘¨â€ğŸ’» ProgramÃ¡tor</span>
                <span class="lang-en hidden">ğŸ‘¨â€ğŸ’» Programmer</span>
            </h3>
            <p><strong>Jaroslav PÅ™ichystal</strong></p>
            
            <p style="margin-top: 15px;">
                <span class="lang-cs">ğŸ“… VytvoÅ™eno: Ãšnor 2026</span>
                <span class="lang-en hidden">ğŸ“… Created: February 2026</span>
            </p>
            
            <div class="license">
                <p style="margin-top: 0;">
                    <span class="lang-cs">ğŸ“œ <strong>Licence:</strong> VolnÃ© nekomerÄnÃ­ pouÅ¾itÃ­ s uvedenÃ­m autora</span>
                    <span class="lang-en hidden">ğŸ“œ <strong>License:</strong> Free non-commercial use with attribution</span>
                </p>
                <p style="font-size: 0.85em; margin: 8px 0;">
                    <span class="lang-cs">âš ï¸ KomerÄnÃ­ vyuÅ¾itÃ­ a zneuÅ¾itÃ­ kÃ³du je zakÃ¡zÃ¡no bez pÃ­semnÃ©ho souhlasu autora.</span>
                    <span class="lang-en hidden">âš ï¸ Commercial use and code misuse are prohibited without written permission.</span>
                </p>
                <p style="margin-bottom: 0;">
                    <span class="lang-cs">Â© 2026 Space League of Justice. VÅ¡echna prÃ¡va vyhrazena.</span>
                    <span class="lang-en hidden">Â© 2026 Space League of Justice. All rights reserved.</span>
                </p>
            </div>
        </div>
    </footer>

    <script>
        // AktuÃ¡lnÃ­ jazyk
        let currentLang = 'cs';

        // PÅ™epnutÃ­ jazyka
        function setLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-cs').forEach(el => {
                el.classList.toggle('hidden', lang !== 'cs');
            });
            document.querySelectorAll('.lang-en').forEach(el => {
                el.classList.toggle('hidden', lang !== 'en');
            });
            document.getElementById('btn-cs').classList.toggle('active', lang === 'cs');
            document.getElementById('btn-en').classList.toggle('active', lang === 'en');
            
            // PÅ™ekreslit vÃ½poÄty pokud existujÃ­
            if (document.getElementById('calculation-card').style.display !== 'none') {
                calculate();
            }
        }

        // VÃ½bÄ›r mÄ›sta z comboboxu
        function selectCity(pointNum) {
            const select = document.getElementById('city' + pointNum);
            const value = select.value;
            if (value) {
                const [lat, lon] = value.split(',').map(Number);
                document.getElementById('lat' + pointNum).value = lat;
                document.getElementById('lon' + pointNum).value = lon;
                calculate();
            }
        }

        // Texty pro oba jazyky
        const texts = {
            cs: {
                step1Title: "ğŸ“ Krok 1: PolomÄ›r ZemÄ› z obvodu rovnÃ­ku",
                step1Desc: "Z obvodu rovnÃ­ku vypoÄÃ­tÃ¡me polomÄ›r. Na plochÃ© mapÄ› je to vzdÃ¡lenost od stÅ™edu k rovnÃ­ku.",
                step2Title: "ğŸ“ Krok 2: Pozice bodu A na plochÃ© mapÄ›",
                step2Desc: "VzdÃ¡lenost od severnÃ­ho pÃ³lu (stÅ™edu) zÃ¡visÃ­ na zemÄ›pisnÃ© Å¡Ã­Å™ce:",
                step2Formula: "r = (90Â° - Å¡Ã­Å™ka) Ã— (obvod / 360Â°)",
                step3Title: "ğŸ“ Krok 3: Pozice bodu B na plochÃ© mapÄ›", 
                step4Title: "ğŸ”„ Krok 4: KartÃ©zskÃ© souÅ™adnice (x, y)",
                step4Desc: "PÅ™evedeme polÃ¡rnÃ­ souÅ™adnice na x, y pro vykreslenÃ­ na mapÄ›:",
                step5Title: "ğŸ“ Krok 5: VZDÃLENOST - Gleasonova projekce (geometrickÃ¡ metoda)",
                step5Desc: "Transformujeme body z 2D Gleasonovy mapy zpÄ›t na 3D sfÃ©ru pomocÃ­ kartÃ©zskÃ½ch vektorÅ¯. Nejprve vypoÄÃ­tÃ¡me tÄ›tivu, pak pÅ™evedeme na oblouk:",
                step5Note: "Tento vÃ½poÄet respektuje geometrii koule, aÄkoliv vychÃ¡zÃ­ z Gleasonovy projekce. VÃ½sledek odpovÃ­dÃ¡ reÃ¡lnÃ© vzdÃ¡lenosti na sfÃ©Å™e.",
                step5Transform: "Transformace z 2D Gleasonovy mapy na 3D sfÃ©ru:",
                step5Vectors: "3D kartÃ©zskÃ© vektory (pomocÃ­ zkracovacÃ­ho koeficientu):",
                step5Coeff: "ZkracovacÃ­ koeficient k = sin(r/R)/(r/R) eliminuje horizontÃ¡lnÃ­ roztaÅ¾enÃ­ mapy k pÃ³lÅ¯m.",
                step5Chord: "tÄ›tiva",
                step5Angle: "Ãºhel",
                step5Distance: "vzdÃ¡lenost",
                haversinTitle: "âœ… PorovnÃ¡nÃ­: Haversinova rovnice (koule)",
                haversinDesc: "Pro porovnÃ¡nÃ­ je zde haversinÅ¯v vzorec â€“ standardnÃ­ vzorec pro vÃ½poÄet vzdÃ¡lenostÃ­ na kouli:",
                flatResult: "Gleasonova projekce",
                flatMethod: "GeometrickÃ¡ metoda (3D transformace)",
                globeResult: "KulatÃ¡ ZemÄ› (Haversin)",
                globeMethod: "StandardnÃ­ vzorec pro kouli",
                matchYes: "âœ… VÃSLEDKY SE PÅ˜ESNÄš SHODUJÃ! (To by se stÃ¡t nemÄ›lo u vÄ›tÅ¡Ã­ch vzdÃ¡lenostÃ­.)",
                difference: "RozdÃ­l",
                whatMeans: "ğŸ¤” Co to znamenÃ¡?",
                explanation1: "Tento vÃ½poÄet pouÅ¾Ã­vÃ¡ geometrickou transformaci z Gleasonovy 2D mapy na 3D sfÃ©ru pomocÃ­ kartÃ©zskÃ½ch vektorÅ¯.",
                explanation2: "ZkracovacÃ­ koeficient k = sin(r/R)/(r/R) zajiÅ¡Å¥uje, Å¾e se horizontÃ¡lnÃ­ roztaÅ¾enÃ­ mapy eliminuje smÄ›rem k pÃ³lÅ¯m.",
                explanation3: "ZÃ¡vÄ›r: Gleasonova projekce je uÅ¾iteÄnÃ¡ pro vizualizaci, ale pro vÃ½poÄet vzdÃ¡lenostÃ­ musÃ­me respektovat geometrii sfÃ©ry.",
                fromPole: "od SevernÃ­ho pÃ³lu (stÅ™edu mapy)"
            },
            en: {
                step1Title: "ğŸ“ Step 1: Earth's radius from equator circumference",
                step1Desc: "From the equator circumference, we calculate the radius. On the flat map, this is the distance from center to equator.",
                step2Title: "ğŸ“ Step 2: Position of point A on flat map",
                step2Desc: "Distance from North Pole (center) depends on latitude:",
                step2Formula: "r = (90Â° - latitude) Ã— (circumference / 360Â°)",
                step3Title: "ğŸ“ Step 3: Position of point B on flat map",
                step4Title: "ğŸ”„ Step 4: Cartesian coordinates (x, y)",
                step4Desc: "Convert polar coordinates to x, y for plotting on map:",
                step5Title: "ğŸ“ Step 5: DISTANCE - Gleason projection (geometric method)",
                step5Desc: "We transform points from 2D Gleason map back to 3D sphere using Cartesian vectors. First calculate the chord, then convert to arc:",
                step5Note: "This calculation respects sphere geometry, even though it starts from Gleason projection. Result matches real distance on sphere.",
                step5Transform: "Transformation from 2D Gleason map to 3D sphere:",
                step5Vectors: "3D Cartesian vectors (using shrinking coefficient):",
                step5Coeff: "Shrinking coefficient k = sin(r/R)/(r/R) eliminates horizontal map stretching towards poles.",
                step5Chord: "chord",
                step5Angle: "angle",
                step5Distance: "distance",
                haversinTitle: "âœ… Comparison: Haversine formula (sphere)",
                haversinDesc: "For comparison, here is the haversine formula â€“ the standard formula for calculating distances on a sphere:",
                flatResult: "Gleason Projection",
                flatMethod: "Geometric method (3D transformation)",
                globeResult: "Globe Earth (Haversine)",
                globeMethod: "Standard formula for sphere",
                matchYes: "âœ… RESULTS MATCH EXACTLY! (This should not happen for large distances.)",
                difference: "Difference",
                whatMeans: "ğŸ¤” What does this mean?",
                explanation1: "This calculation uses geometric transformation from Gleason's 2D map to 3D sphere using Cartesian vectors.",
                explanation2: "The shrinking coefficient k = sin(r/R)/(r/R) ensures that horizontal map stretching is eliminated towards the poles.",
                explanation3: "Conclusion: Gleason projection is useful for visualization, but for distance calculation we must respect sphere geometry.",
                fromPole: "from North Pole (center of map)"
            }
        };

        // PÅ™evod stupÅˆÅ¯ na radiÃ¡ny
        function toRadians(degrees) {
            return degrees * Math.PI / 180;
        }

        // SfÃ©rickÃ½ kosinovÃ½ vzorec (sprÃ¡vnÃ½ vÃ½poÄet vzdÃ¡lenosti)
        function sphericalDistance(lat1, lon1, lat2, lon2, circumference) {
            const R = circumference / (2 * Math.PI);
            
            const Ï†1 = toRadians(lat1);
            const Ï†2 = toRadians(lat2);
            const Î”Î» = toRadians(lon2 - lon1);
            
            // SfÃ©rickÃ½ kosinovÃ½ vzorec
            const cosD = Math.sin(Ï†1) * Math.sin(Ï†2) + Math.cos(Ï†1) * Math.cos(Ï†2) * Math.cos(Î”Î»);
            const d = R * Math.acos(Math.min(1, Math.max(-1, cosD)));
            
            return d;
        }

        /**
         * VÃ½poÄet vzdÃ¡lenosti pomocÃ­ Gleasonovy projekce (geometrickÃ¡ metoda)
         * 
         * MÃ­sto pÅ™Ã­mÃ©ho pouÅ¾itÃ­ Haversinova vzorce transformujeme souÅ™adnice
         * z 2D Gleasonovy mapy zpÄ›t na 3D sfÃ©ru pomocÃ­ kartÃ©zskÃ½ch vektorÅ¯.
         * VÃ½sledek bude odpovÃ­dat reÃ¡lnÃ© vzdÃ¡lenosti na kouli.
         * 
         * @param {number} lat1 - ZemÄ›pisnÃ¡ Å¡Ã­Å™ka prvnÃ­ho bodu (ve stupnÃ­ch)
         * @param {number} lon1 - ZemÄ›pisnÃ¡ dÃ©lka prvnÃ­ho bodu (ve stupnÃ­ch)
         * @param {number} lat2 - ZemÄ›pisnÃ¡ Å¡Ã­Å™ka druhÃ©ho bodu (ve stupnÃ­ch)
         * @param {number} lon2 - ZemÄ›pisnÃ¡ dÃ©lka druhÃ©ho bodu (ve stupnÃ­ch)
         * @param {number} circumference - Obvod rovnÃ­ku (standardnÄ› 40075 km)
         * @returns {number} VzdÃ¡lenost v kilometrech
         */
        function calculateGleasonDistance(lat1, lon1, lat2, lon2, circumference) {
            // PolomÄ›r ZemÄ› z obvodu rovnÃ­ku
            const R = circumference / (2 * Math.PI);
            
            // KROK 1: PÅ™evod GPS souÅ™adnic na polÃ¡rnÃ­ souÅ™adnice Gleasonovy mapy
            // r = vzdÃ¡lenost od stÅ™edu (severnÃ­ho pÃ³lu) v km
            // Î¸ = Ãºhel (longitude) v radiÃ¡nech
            
            const lat1Rad = toRadians(lat1);
            const lat2Rad = toRadians(lat2);
            const lon1Rad = toRadians(lon1);
            const lon2Rad = toRadians(lon2);
            
            // VzdÃ¡lenost od severnÃ­ho pÃ³lu na GleasonovÄ› mapÄ›
            // Pro lat = 90Â° â†’ r = 0 (stÅ™ed)
            // Pro lat = 0Â° â†’ r = R Ã— Ï€/2 (rovnÃ­k)
            // Pro lat = -90Â° â†’ r = R Ã— Ï€ (okraj)
            const r1 = R * (Math.PI / 2 - lat1Rad);
            const r2 = R * (Math.PI / 2 - lat2Rad);
            
            // KROK 2: VytvoÅ™enÃ­ korigovanÃ½ch 3D kartÃ©zskÃ½ch vektorÅ¯
            // Tyto vektory mapujÃ­ 2D bod z Gleasonovy mapy zpÄ›t na 3D sfÃ©ru
            
            // ZkracovacÃ­ koeficient k = sin(r/R) / (r/R)
            // Tento koeficient eliminuje horizontÃ¡lnÃ­ roztaÅ¾enÃ­ mapy smÄ›rem k pÃ³lÅ¯m.
            // BlÃ­Å¾e k pÃ³lu (malÃ© r) â†’ k â‰ˆ 1 (skoro Å¾Ã¡dnÃ¡ korekce)
            // DÃ¡le od pÃ³lu (velkÃ© r) â†’ k < 1 (vÄ›tÅ¡Ã­ zkracovÃ¡nÃ­)
            
            // Pro bod 1:
            const rOverR1 = r1 / R;  // normalizovanÃ¡ vzdÃ¡lenost (v radiÃ¡nech)
            const sinTerm1 = Math.sin(rOverR1);
            const cosTerm1 = Math.cos(rOverR1);
            
            // KartÃ©zskÃ© souÅ™adnice na 3D sfÃ©Å™e:
            // x a y tvoÅ™Ã­ horizontÃ¡lnÃ­ rovinu, z je vertikÃ¡lnÃ­ osa
            const x1 = R * sinTerm1 * Math.cos(lon1Rad);
            const y1 = R * sinTerm1 * Math.sin(lon1Rad);
            const z1 = R * cosTerm1;
            
            // Pro bod 2:
            const rOverR2 = r2 / R;
            const sinTerm2 = Math.sin(rOverR2);
            const cosTerm2 = Math.cos(rOverR2);
            
            const x2 = R * sinTerm2 * Math.cos(lon2Rad);
            const y2 = R * sinTerm2 * Math.sin(lon2Rad);
            const z2 = R * cosTerm2;
            
            // KROK 3: VÃ½poÄet dÃ©lky tÄ›tivy mezi dvÄ›ma body v 3D prostoru
            // TÄ›tiva je pÅ™Ã­mka spojujÃ­cÃ­ dva body na sfÃ©Å™e
            const dx = x2 - x1;
            const dy = y2 - y1;
            const dz = z2 - z1;
            
            const chordLength = Math.sqrt(dx * dx + dy * dy + dz * dz);
            
            // KROK 4: PÅ™evod tÄ›tivy na dÃ©lku oblouku
            // TÄ›tiva je pÅ™Ã­mka skrz "Zemi", ale my potÅ™ebujeme vzdÃ¡lenost po povrchu
            // Vztah: chord = 2R Ã— sin(Î¸/2), kde Î¸ je Ãºhel mezi body
            // Tedy: Î¸ = 2 Ã— arcsin(chord / (2R))
            // A dÃ©lka oblouku: d = R Ã— Î¸
            
            const centralAngle = 2 * Math.asin(Math.min(1, chordLength / (2 * R)));
            const arcLength = R * centralAngle;
            
            return arcLength;
        }

        // Haversinova rovnice (pro porovnÃ¡nÃ­)
        function haversineDistance(lat1, lon1, lat2, lon2, circumference) {
            const R = circumference / (2 * Math.PI);
            
            const Ï†1 = toRadians(lat1);
            const Ï†2 = toRadians(lat2);
            const Î”Ï† = toRadians(lat2 - lat1);
            const Î”Î» = toRadians(lon2 - lon1);

            const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +
                      Math.cos(Ï†1) * Math.cos(Ï†2) *
                      Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);
            
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c;
        }

        // VÃ½poÄet pozic na plochÃ© mapÄ› (pro vizualizaci)
        function getFlatMapPosition(lat, lon, circumference) {
            // VzdÃ¡lenost od severnÃ­ho pÃ³lu (+90Â°) k danÃ©mu bodu
            // Pro lat = +90Â° -> r = 0 (stÅ™ed)
            // Pro lat = 0Â° (rovnÃ­k) -> r = 90Â° Ã— (obvod/360Â°) = obvod/4
            // Pro lat = -90Â° -> r = 180Â° Ã— (obvod/360Â°) = obvod/2 (okraj)
            const r = (90 - lat) * (circumference / 360);
            const lonRad = toRadians(lon);
            
            const x = r * Math.sin(lonRad);
            const y = -r * Math.cos(lonRad); // zÃ¡pornÃ©, aby sever (0Â° lon) byl nahoÅ™e
            
            return { r, x, y, lonRad };
        }

        // HlavnÃ­ funkce vÃ½poÄtu
        function calculate() {
            const lat1 = parseCoordinate(document.getElementById('lat1').value);
            const lon1 = parseCoordinate(document.getElementById('lon1').value);
            const lat2 = parseCoordinate(document.getElementById('lat2').value);
            const lon2 = parseCoordinate(document.getElementById('lon2').value);
            const circumference = parseFloat(document.getElementById('circumference').value);

            // Validace
            if (lat1 < -90 || lat1 > 90 || lat2 < -90 || lat2 > 90) {
                alert(currentLang === 'cs' ? 'ZemÄ›pisnÃ¡ Å¡Ã­Å™ka musÃ­ bÃ½t mezi -90Â° a +90Â°!' : 'Latitude must be between -90Â° and +90Â°!');
                return;
            }
            if (lon1 < -180 || lon1 > 180 || lon2 < -180 || lon2 > 180) {
                alert(currentLang === 'cs' ? 'ZemÄ›pisnÃ¡ dÃ©lka musÃ­ bÃ½t mezi -180Â° a +180Â°!' : 'Longitude must be between -180Â° and +180Â°!');
                return;
            }

            // VÃ½poÄty
            const pos1 = getFlatMapPosition(lat1, lon1, circumference);
            const pos2 = getFlatMapPosition(lat2, lon2, circumference);
            // VÃ½poÄet vzdÃ¡lenosti pomocÃ­ Gleasonovy projekce (geometrickÃ¡ metoda)
            const gleasonDist = calculateGleasonDistance(lat1, lon1, lat2, lon2, circumference);
            // Pro porovnÃ¡nÃ­ ponechÃ¡me haversin
            const haversineDist = haversineDistance(lat1, lon1, lat2, lon2, circumference);
            const radius = circumference / (2 * Math.PI);

            // ZobrazenÃ­ vÃ½poÄtu
            displayCalculation(lat1, lon1, lat2, lon2, circumference, radius, pos1, pos2, gleasonDist, haversineDist);
            // ZobrazenÃ­ vÃ½sledku
            displayResult(gleasonDist, haversineDist);
            // VykreslenÃ­ mapy
            drawFlatEarth(lat1, lon1, lat2, lon2, circumference, pos1, pos2, gleasonDist);
        }

        // ZobrazenÃ­ krokÅ¯ vÃ½poÄtu
        function displayCalculation(lat1, lon1, lat2, lon2, circumference, radius, pos1, pos2, sphericalDist, haversineDist) {
            const stepsDiv = document.getElementById('calculation-steps');
            document.getElementById('calculation-card').style.display = 'block';
            const t = texts[currentLang];

            stepsDiv.innerHTML = `
                <div class="calculation-step">
                    <h4>${t.step1Title}</h4>
                    <p>${t.step1Desc}</p>
                    <div class="formula">R = circumference / (2 Ã— Ï€)</div>
                    <div class="substitution">R = ${circumference} km / (2 Ã— ${Math.PI.toFixed(6)})</div>
                    <div class="result-value">R = ${radius.toFixed(4)} km</div>
                </div>

                <div class="calculation-step">
                    <h4>${t.step2Title}</h4>
                    <p>${t.step2Desc}</p>
                    <div class="formula">${t.step2Formula}</div>
                    <div class="substitution">râ‚ = (90Â° - ${lat1}Â°) Ã— (${circumference} / 360)</div>
                    <div class="substitution">râ‚ = ${(90 - lat1).toFixed(4)}Â° Ã— ${(circumference / 360).toFixed(4)} km/Â°</div>
                    <div class="result-value">râ‚ = ${pos1.r.toFixed(4)} km ${t.fromPole}</div>
                </div>

                <div class="calculation-step">
                    <h4>${t.step3Title}</h4>
                    <div class="formula">${t.step2Formula}</div>
                    <div class="substitution">râ‚‚ = (90Â° - ${lat2}Â°) Ã— (${circumference} / 360)</div>
                    <div class="substitution">râ‚‚ = ${(90 - lat2).toFixed(4)}Â° Ã— ${(circumference / 360).toFixed(4)} km/Â°</div>
                    <div class="result-value">râ‚‚ = ${pos2.r.toFixed(4)} km ${t.fromPole}</div>
                </div>

                <div class="calculation-step">
                    <h4>${t.step4Title}</h4>
                    <p>${t.step4Desc}</p>
                    <div class="formula">x = r Ã— sin(longitude)    y = -r Ã— cos(longitude)</div>
                    <p><strong>A (${lat1}Â°, ${lon1}Â°):</strong></p>
                    <div class="substitution">xâ‚ = ${pos1.r.toFixed(2)} Ã— sin(${lon1}Â°) = ${pos1.x.toFixed(2)} km</div>
                    <div class="substitution">yâ‚ = -${pos1.r.toFixed(2)} Ã— cos(${lon1}Â°) = ${pos1.y.toFixed(2)} km</div>
                    <p><strong>B (${lat2}Â°, ${lon2}Â°):</strong></p>
                    <div class="substitution">xâ‚‚ = ${pos2.r.toFixed(2)} Ã— sin(${lon2}Â°) = ${pos2.x.toFixed(2)} km</div>
                    <div class="substitution">yâ‚‚ = -${pos2.r.toFixed(2)} Ã— cos(${lon2}Â°) = ${pos2.y.toFixed(2)} km</div>
                </div>

                <div class="calculation-step" style="border-left-color: #e74c3c; background: #fff0f0;">
                    <h4>${t.step5Title}</h4>
                    <p><strong style="color: #e74c3c;">${t.step5Desc}</strong></p>
                    <p style="margin: 10px 0; padding: 10px; background: #e8f4fd; border-radius: 5px; font-size: 0.95em;">
                        ğŸ”„ <strong>${t.step5Transform}</strong><br>
                        râ‚ = ${pos1.r.toFixed(2)} km, Î¸â‚ = ${lon1}Â°<br>
                        râ‚‚ = ${pos2.r.toFixed(2)} km, Î¸â‚‚ = ${lon2}Â°<br>
                        <br>
                        ğŸ“ <strong>${t.step5Vectors}</strong><br>
                        x = R Ã— sin(r/R) Ã— cos(lon)<br>
                        y = R Ã— sin(r/R) Ã— sin(lon)<br>
                        z = R Ã— cos(r/R)<br>
                        <br>
                        <em>${t.step5Coeff}</em>
                    </p>
                    <div class="formula">${t.step5Chord} = âˆš[(xâ‚‚ - xâ‚)Â² + (yâ‚‚ - yâ‚)Â² + (zâ‚‚ - zâ‚)Â²]</div>
                    <div class="formula">${t.step5Angle} = 2 Ã— arcsin(${t.step5Chord} / (2R))</div>
                    <div class="formula">${t.step5Distance} = R Ã— ${t.step5Angle}</div>
                    <div class="result-value" style="font-size: 1.3em; background: #ffe0e0;">
                        d = ${sphericalDist.toFixed(4)} km
                    </div>
                    <p style="margin-top: 15px; padding: 10px; background: #d4edda; border-radius: 5px;">
                        âœ… <em>${t.step5Note}</em>
                    </p>
                </div>

                <div class="calculation-step" style="border-left-color: #27ae60; background: #f0fff0;">
                    <h4>${t.haversinTitle}</h4>
                    <p>${t.haversinDesc}</p>
                    <div class="formula">d = 2R Ã— arcsin( âˆš[sinÂ²(Î”Ï†/2) + cos(Ï†â‚) Ã— cos(Ï†â‚‚) Ã— sinÂ²(Î”Î»/2)] )</div>
                    <div class="result-value" style="background: #d4edda;">Haversine: ${haversineDist.toFixed(4)} km</div>
                </div>
            `;
        }

        // ZobrazenÃ­ vÃ½sledku
        function displayResult(sphericalDist, haversineDist) {
            const resultDiv = document.getElementById('result-content');
            document.getElementById('result-card').style.display = 'block';
            const t = texts[currentLang];

            const difference = Math.abs(sphericalDist - haversineDist);
            const percentDiff = haversineDist > 0 ? (difference / haversineDist * 100) : 0;
            const isMatch = percentDiff < 0.0001;

            resultDiv.innerHTML = `
                <div class="comparison">
                    <div class="comparison-box flat">
                        <h3>ğŸ—ºï¸ ${t.flatResult}</h3>
                        <div class="distance">${sphericalDist.toFixed(2)} km</div>
                        <p>${t.flatMethod}</p>
                    </div>
                    <div class="comparison-box globe">
                        <h3>ğŸŒ ${t.globeResult}</h3>
                        <div class="distance">${haversineDist.toFixed(2)} km</div>
                        <p>${t.globeMethod}</p>
                    </div>
                </div>

                <div class="match" style="background: ${isMatch ? '#28a745' : '#ffc107'}; color: ${isMatch ? 'white' : '#333'};">
                    ${isMatch 
                        ? t.matchYes
                        : `âš ï¸ ${t.difference}: ${difference.toFixed(6)} km (${percentDiff.toFixed(6)}%)`}
                </div>

                <div class="explanation" style="margin-top: 20px; background: #fff3cd;">
                    <h4>${t.whatMeans}</h4>
                    <p>ğŸ‘‰ ${t.explanation1}</p>
                    <p>ğŸ‘‰ ${t.explanation2}</p>
                    <p><strong>ğŸ‘‰ ${t.explanation3}</strong></p>
                </div>
            `;
        }

        // ObrÃ¡zek mapy (naÄte se jednou)
        let mapImage = null;
        let mapLoaded = false;

        function loadMapImage() {
            mapImage = new Image();
            mapImage.onload = function() {
                mapLoaded = true;
                calculate(); // PÅ™ekreslit po naÄtenÃ­
            };
            mapImage.onerror = function() {
                console.log('Nelze naÄÃ­st obrÃ¡zek mapy, pouÅ¾iji nÃ¡hradnÃ­ vykreslenÃ­');
                mapLoaded = false;
            };
            mapImage.src = 'img/Azimuthal_equidistant_projection_SW.jpg';
        }

        // VykreslenÃ­ plochÃ© ZemÄ› s reÃ¡lnou mapou
        function drawFlatEarth(lat1, lon1, lat2, lon2, circumference, pos1, pos2, distance) {
            const canvas = document.getElementById('flatEarthCanvas');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const maxRadius = Math.min(centerX, centerY) - 10;

            // MaximÃ¡lnÃ­ vzdÃ¡lenost od pÃ³lu (lat = -90) = 180Â° Ã— (obvod/360) = obvod/2
            const maxMapRadius = 180 * (circumference / 360);
            const scale = maxRadius / maxMapRadius;

            // VyÄistit canvas
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Nakreslit obrÃ¡zek mapy nebo nÃ¡hradnÃ­ grafiku
            if (mapLoaded && mapImage) {
                // ObrÃ¡zek je azimutÃ¡lnÃ­ projekce SW (centered on South Pole originally, ale tato verze je severnÃ­)
                // Mapa mÃ¡ 0Â° longitude nahoÅ™e
                ctx.save();
                ctx.beginPath();
                ctx.arc(centerX, centerY, maxRadius, 0, 2 * Math.PI);
                ctx.clip();
                
                // Nakreslit obrÃ¡zek do kruhu
                const imgSize = maxRadius * 2;
                ctx.drawImage(mapImage, centerX - maxRadius, centerY - maxRadius, imgSize, imgSize);
                ctx.restore();
            } else {
                // NÃ¡hradnÃ­ vykreslenÃ­
                ctx.fillStyle = '#1a3a5c';
                ctx.beginPath();
                ctx.arc(centerX, centerY, maxRadius, 0, 2 * Math.PI);
                ctx.fill();

                // RovnobÄ›Å¾ky
                const latitudes = [60, 30, 0, -30, -60];
                latitudes.forEach(lat => {
                    const r = (90 - lat) * (circumference / 360) * scale;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, r, 0, 2 * Math.PI);
                    ctx.strokeStyle = lat === 0 ? 'rgba(52, 152, 219, 0.8)' : 'rgba(243, 156, 18, 0.5)';
                    ctx.lineWidth = lat === 0 ? 2 : 1;
                    ctx.setLineDash(lat === 0 ? [] : [5, 5]);
                    ctx.stroke();
                });
                ctx.setLineDash([]);

                // PolednÃ­ky
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.lineWidth = 0.5;
                for (let lon = 0; lon < 360; lon += 30) {
                    const lonRad = toRadians(lon);
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(
                        centerX + maxRadius * Math.sin(lonRad),
                        centerY - maxRadius * Math.cos(lonRad)
                    );
                    ctx.stroke();
                }
            }

            // Okraj mapy
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(centerX, centerY, maxRadius, 0, 2 * Math.PI);
            ctx.stroke();

            // SevernÃ­ pÃ³l (stÅ™ed)
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(centerX, centerY, 6, 0, 2 * Math.PI);
            ctx.fill();
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Popisek severnÃ­ho pÃ³lu
            ctx.fillStyle = 'rgba(0,0,0,0.7)';
            ctx.fillRect(centerX - 25, centerY - 28, 50, 16);
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 10px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('90Â°N', centerX, centerY - 16);
            ctx.textAlign = 'left';

            // Funkce pro vÃ½poÄet pozice na mapÄ›
            // Mapa "Azimuthal_equidistant_projection_SW.jpg" mÃ¡ 0Â° longitude DOLE (smÄ›r k Africe/EvropÄ›)
            // a Ãºhly rostou PO smÄ›ru hodinovÃ½ch ruÄiÄek (vÃ½chod je VPRAVO)
            function getScreenPos(lat, lon) {
                const r = (90 - lat) * (circumference / 360) * scale;
                const lonRad = toRadians(lon);
                // Orientace tÃ©to mapy: 0Â° dole, vÃ½chod (kladnÃ¡ lon) vpravo
                const x = centerX + r * Math.sin(lonRad);
                const y = centerY + r * Math.cos(lonRad);
                return { x, y, r };
            }

            const screenPos1 = getScreenPos(lat1, lon1);
            const screenPos2 = getScreenPos(lat2, lon2);

            // ÄŒÃ¡ra mezi body
            const dist1 = Math.sqrt(Math.pow(screenPos1.x - centerX, 2) + Math.pow(screenPos1.y - centerY, 2));
            const dist2 = Math.sqrt(Math.pow(screenPos2.x - centerX, 2) + Math.pow(screenPos2.y - centerY, 2));

            if (dist1 <= maxRadius && dist2 <= maxRadius) {
                // StÃ­n ÄÃ¡ry
                ctx.strokeStyle = 'rgba(0,0,0,0.5)';
                ctx.lineWidth = 5;
                ctx.beginPath();
                ctx.moveTo(screenPos1.x + 2, screenPos1.y + 2);
                ctx.lineTo(screenPos2.x + 2, screenPos2.y + 2);
                ctx.stroke();

                // HlavnÃ­ ÄÃ¡ra
                ctx.strokeStyle = '#2ecc71';
                ctx.lineWidth = 3;
                ctx.setLineDash([8, 4]);
                ctx.beginPath();
                ctx.moveTo(screenPos1.x, screenPos1.y);
                ctx.lineTo(screenPos2.x, screenPos2.y);
                ctx.stroke();
                ctx.setLineDash([]);

                // VzdÃ¡lenost uprostÅ™ed
                const midX = (screenPos1.x + screenPos2.x) / 2;
                const midY = (screenPos1.y + screenPos2.y) / 2;
                
                // PozadÃ­ textu
                ctx.fillStyle = 'rgba(46, 204, 113, 0.9)';
                const distText = distance.toFixed(0) + ' km';
                const textWidth = ctx.measureText(distText).width + 16;
                ctx.fillRect(midX - textWidth/2, midY - 22, textWidth, 20);
                
                ctx.fillStyle = 'white';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(distText, midX, midY - 8);
                ctx.textAlign = 'left';
            }

            // Velikost bodu (menÅ¡Ã­)
            const pointRadius = 6;

            // Bod A (ÄervenÃ½)
            if (dist1 <= maxRadius) {
                // Bod
                ctx.fillStyle = '#e74c3c';
                ctx.beginPath();
                ctx.arc(screenPos1.x, screenPos1.y, pointRadius, 0, 2 * Math.PI);
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Popisek - VEDLE bodu, ne pÅ™es nÄ›j
                ctx.fillStyle = 'rgba(231, 76, 60, 0.85)';
                ctx.font = 'bold 9px Arial';
                const label1 = 'A';
                ctx.textAlign = 'left';
                ctx.fillText(label1, screenPos1.x + pointRadius + 3, screenPos1.y + 3);
            }

            // Bod B (modrÃ½)
            if (dist2 <= maxRadius) {
                // Bod
                ctx.fillStyle = '#3498db';
                ctx.beginPath();
                ctx.arc(screenPos2.x, screenPos2.y, pointRadius, 0, 2 * Math.PI);
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Popisek - VEDLE bodu
                ctx.fillStyle = 'rgba(52, 152, 219, 0.85)';
                ctx.font = 'bold 9px Arial';
                const label2 = 'B';
                ctx.textAlign = 'left';
                ctx.fillText(label2, screenPos2.x + pointRadius + 3, screenPos2.y + 3);
            }

            // Vykreslit detailnÃ­ pohled
            drawDetailView(lat1, lon1, lat2, lon2, circumference, distance);

            // PoznÃ¡mka dole
            const note = currentLang === 'cs' 
                ? 'âš ï¸ PÅ™Ã­mÃ¡ ÄÃ¡ra na mapÄ› â‰  skuteÄnÃ¡ vzdÃ¡lenost!' 
                : 'âš ï¸ Straight line on map â‰  actual distance!';
            ctx.fillStyle = 'rgba(0,0,0,0.7)';
            ctx.fillRect(5, canvas.height - 25, ctx.measureText(note).width + 10, 20);
            ctx.fillStyle = '#ffc107';
            ctx.font = 'bold 11px Arial';
            ctx.fillText(note, 10, canvas.height - 10);
        }

        // VykreslenÃ­ detailnÃ­ho pohledu
        function drawDetailView(lat1, lon1, lat2, lon2, circumference, distance) {
            const canvas = document.getElementById('detailCanvas');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // VyÄistit
            ctx.fillStyle = '#1a3a5c';
            ctx.fillRect(0, 0, width, height);

            // Parametry hlavnÃ­ mapy (musÃ­ odpovÃ­dat drawFlatEarth)
            const mainCanvas = document.getElementById('flatEarthCanvas');
            const mainCenterX = mainCanvas.width / 2;
            const mainCenterY = mainCanvas.height / 2;
            const mainMaxRadius = Math.min(mainCenterX, mainCenterY) - 10; // StejnÃ© jako v drawFlatEarth
            // StejnÃ½ vÃ½poÄet scale jako v drawFlatEarth
            const mainMaxMapRadius = 180 * (circumference / 360); // = circumference / 2
            const mainScale = mainMaxRadius / mainMaxMapRadius;

            // Funkce pro vÃ½poÄet pozice na hlavnÃ­ mapÄ› (stejnÃ¡ jako v drawFlatEarth)
            function getMainMapPos(lat, lon) {
                const r = (90 - lat) * (circumference / 360) * mainScale;
                const lonRad = lon * Math.PI / 180;
                const x = mainCenterX + r * Math.sin(lonRad);
                const y = mainCenterY + r * Math.cos(lonRad);
                return { x, y };
            }

            // Pozice bodÅ¯ na hlavnÃ­ mapÄ›
            const mainPos1 = getMainMapPos(lat1, lon1);
            const mainPos2 = getMainMapPos(lat2, lon2);

            // StÅ™ed mezi body na hlavnÃ­ mapÄ› (v pixelech hlavnÃ­ho canvasu)
            const mainMidX = (mainPos1.x + mainPos2.x) / 2;
            const mainMidY = (mainPos1.y + mainPos2.y) / 2;

            // VzdÃ¡lenost mezi body na hlavnÃ­ mapÄ› (v pixelech)
            const mainDist = Math.sqrt(Math.pow(mainPos2.x - mainPos1.x, 2) + Math.pow(mainPos2.y - mainPos1.y, 2));
            
            // Velikost vÃ½Å™ezu na hlavnÃ­ mapÄ› (s okrajem) - minimÃ¡lnÄ› 50px
            // MenÅ¡Ã­ hodnota = vÄ›tÅ¡Ã­ pÅ™iblÃ­Å¾enÃ­
            const cropSize = Math.max(mainDist * 1.5, 50);

            // Vykreslit vÃ½Å™ez mapy
            if (mapImage && mapImage.complete) {
                // Na hlavnÃ­ mapÄ› je obrÃ¡zek vykreslen do Ätverce o stranÄ› maxRadius*2
                // ale obrÃ¡zek samotnÃ½ mÃ¡ svou vlastnÃ­ velikost
                // PomÄ›r: kolik pixelÅ¯ obrÃ¡zku odpovÃ­dÃ¡ 1 pixelu na canvasu hlavnÃ­ mapy
                const mainImgSize = mainMaxRadius * 2; // velikost obrÃ¡zku na hlavnÃ­ mapÄ› v pixelech canvasu
                const imgToCanvasRatio = mapImage.width / mainImgSize;
                
                // StÅ™ed obrÃ¡zku odpovÃ­dÃ¡ stÅ™edu hlavnÃ­ mapy
                const imgCenterX = mapImage.width / 2;
                const imgCenterY = mapImage.height / 2;
                
                // Offset stÅ™edu vÃ½Å™ezu od stÅ™edu mapy (v pixelech hlavnÃ­ mapy)
                const offsetX = mainMidX - mainCenterX;
                const offsetY = mainMidY - mainCenterY;
                
                // Pozice stÅ™edu vÃ½Å™ezu v souÅ™adnicÃ­ch obrÃ¡zku
                const srcCenterX = imgCenterX + offsetX * imgToCanvasRatio;
                const srcCenterY = imgCenterY + offsetY * imgToCanvasRatio;
                
                // Velikost vÃ½Å™ezu v souÅ™adnicÃ­ch obrÃ¡zku
                const srcSize = cropSize * imgToCanvasRatio;
                
                // VÃ½Å™ez ze zdrojovÃ©ho obrÃ¡zku
                const srcX = srcCenterX - srcSize / 2;
                const srcY = srcCenterY - srcSize / 2;
                
                ctx.drawImage(
                    mapImage,
                    srcX, srcY, srcSize, srcSize,  // zdrojovÃ½ vÃ½Å™ez
                    0, 0, width, height             // cÃ­lovÃ¡ oblast (celÃ½ canvas)
                );
            }

            // Zoom faktor pro vÃ½poÄet pozic bodÅ¯
            const zoomFactor = width / cropSize;

            // Funkce pro pÅ™evod souÅ™adnic hlavnÃ­ mapy na detail canvas
            function toDetailScreen(mainX, mainY) {
                const x = (mainX - mainMidX) * zoomFactor + width / 2;
                const y = (mainY - mainMidY) * zoomFactor + height / 2;
                return { x, y };
            }

            // PoloprÅ¯hlednÃ¡ mÅ™Ã­Å¾ka pÅ™es mapu
            ctx.strokeStyle = 'rgba(255,255,255,0.4)';
            ctx.lineWidth = 1;
            
            // Nakreslit rovnobÄ›Å¾ky a polednÃ­ky
            for (let lat = -80; lat <= 80; lat += 10) {
                for (let lon = -180; lon <= 180; lon += 10) {
                    const p1 = getMainMapPos(lat, lon);
                    const p2 = getMainMapPos(lat, lon + 10);
                    const p3 = getMainMapPos(lat + 10, lon);
                    
                    const d1 = toDetailScreen(p1.x, p1.y);
                    const d2 = toDetailScreen(p2.x, p2.y);
                    const d3 = toDetailScreen(p3.x, p3.y);
                    
                    // ÄŒÃ¡ra podÃ©l rovnobÄ›Å¾ky
                    ctx.beginPath();
                    ctx.moveTo(d1.x, d1.y);
                    ctx.lineTo(d2.x, d2.y);
                    ctx.stroke();
                    
                    // ÄŒÃ¡ra podÃ©l polednÃ­ku
                    ctx.beginPath();
                    ctx.moveTo(d1.x, d1.y);
                    ctx.lineTo(d3.x, d3.y);
                    ctx.stroke();
                }
            }

            // Pozice bodÅ¯ v detailnÃ­m pohledu
            const pos1 = toDetailScreen(mainPos1.x, mainPos1.y);
            const pos2 = toDetailScreen(mainPos2.x, mainPos2.y);

            // ÄŒÃ¡ra mezi body
            ctx.strokeStyle = '#2ecc71';
            ctx.lineWidth = 3;
            ctx.setLineDash([6, 3]);
            ctx.beginPath();
            ctx.moveTo(pos1.x, pos1.y);
            ctx.lineTo(pos2.x, pos2.y);
            ctx.stroke();
            ctx.setLineDash([]);

            // VzdÃ¡lenost uprostÅ™ed
            const midX = (pos1.x + pos2.x) / 2;
            const midY = (pos1.y + pos2.y) / 2;
            ctx.fillStyle = 'rgba(46, 204, 113, 0.9)';
            const distText = distance.toFixed(1) + ' km';
            ctx.font = 'bold 11px Arial';
            const textWidth = ctx.measureText(distText).width + 12;
            ctx.fillRect(midX - textWidth/2, midY - 18, textWidth, 18);
            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.fillText(distText, midX, midY - 5);
            ctx.textAlign = 'left';

            // Bod A
            ctx.fillStyle = '#e74c3c';
            ctx.beginPath();
            ctx.arc(pos1.x, pos1.y, 10, 0, 2 * Math.PI);
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.fillStyle = 'white';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('A', pos1.x, pos1.y + 4);
            
            // Popisek A
            ctx.fillStyle = 'rgba(231, 76, 60, 0.9)';
            const labelA = `${lat1.toFixed(2)}Â°, ${lon1.toFixed(2)}Â°`;
            ctx.font = '10px Arial';
            const labelAWidth = ctx.measureText(labelA).width + 8;
            ctx.fillRect(pos1.x - labelAWidth/2, pos1.y - 28, labelAWidth, 16);
            ctx.fillStyle = 'white';
            ctx.fillText(labelA, pos1.x, pos1.y - 16);
            ctx.textAlign = 'left';

            // Bod B
            ctx.fillStyle = '#3498db';
            ctx.beginPath();
            ctx.arc(pos2.x, pos2.y, 10, 0, 2 * Math.PI);
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.fillStyle = 'white';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('B', pos2.x, pos2.y + 4);
            
            // Popisek B
            ctx.fillStyle = 'rgba(52, 152, 219, 0.9)';
            const labelB = `${lat2.toFixed(2)}Â°, ${lon2.toFixed(2)}Â°`;
            ctx.font = '10px Arial';
            const labelBWidth = ctx.measureText(labelB).width + 8;
            ctx.fillRect(pos2.x - labelBWidth/2, pos2.y + 14, labelBWidth, 16);
            ctx.fillStyle = 'white';
            ctx.fillText(labelB, pos2.x, pos2.y + 26);
            ctx.textAlign = 'left';

            // Info o mÄ›Å™Ã­tku - vypoÄteno z aktuÃ¡lnÃ­ho zoomu
            const kmPerPixel = (cropSize / zoomFactor) * (circumference / 4) / mainMaxRadius / (width);
            const targetBarPx = 60; // cÃ­lovÃ¡ dÃ©lka mÄ›Å™Ã­tkovÃ© ÄÃ¡ry v pixelech
            let scaleBarKm = kmPerPixel * targetBarPx;
            
            // Zaokrouhlit na hezkÃ© ÄÃ­slo
            if (scaleBarKm > 1000) scaleBarKm = Math.round(scaleBarKm / 500) * 500;
            else if (scaleBarKm > 100) scaleBarKm = Math.round(scaleBarKm / 100) * 100;
            else if (scaleBarKm > 10) scaleBarKm = Math.round(scaleBarKm / 10) * 10;
            else scaleBarKm = Math.round(scaleBarKm);
            if (scaleBarKm < 1) scaleBarKm = 1;
            
            const scaleBarPx = scaleBarKm / kmPerPixel;

            // MÄ›Å™Ã­tkovÃ¡ ÄÃ¡ra
            ctx.fillStyle = 'rgba(0,0,0,0.7)';
            ctx.fillRect(width - scaleBarPx - 20, height - 35, scaleBarPx + 10, 25);
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(width - scaleBarPx - 10, height - 20);
            ctx.lineTo(width - 15, height - 20);
            ctx.stroke();
            ctx.fillStyle = 'white';
            ctx.font = 'bold 10px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(scaleBarKm + ' km', width - scaleBarPx/2 - 10, height - 23);
            ctx.textAlign = 'left';
        }

        // Spustit pÅ™i naÄtenÃ­
        window.onload = function() {
            loadMapImage();
            calculate();
        };
    </script>
</body>
</html>
